<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Whack-a-Mole | MindHack.in</title>
  <style>
    :root{
      --bg:#fdf6e3;
      --ink:#22303a;
      --muted:#6b7b86;
      --brand:#4f46e5;
      --brand-2:#22c55e;
      --card:#ffffff;
      --hole:#e7eef3;
      --danger:#ef4444;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji";
      color:var(--ink);
      background:var(--bg);
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:18px;
      gap:16px;
    }

    header{
      text-align:center;
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    h1{
      margin:0;
      font-size:clamp(20px,4.5vw,32px);
      letter-spacing:.3px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:clamp(12px,2.8vw,14px);
    }

    .hud{
      width:min(920px,100%);
      background:var(--card);
      border-radius:18px;
      box-shadow: 0 10px 30px rgba(0,0,0,.06);
      padding:14px;
      display:flex;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .stats{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
    }
    .badge{
      background:#eef2ff;
      color:#3730a3;
      padding:8px 12px;
      border-radius:12px;
      font-weight:600;
      min-width:90px;
      text-align:center;
    }
    .controls{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
    }
    select, button{
      appearance:none;
      border:1px solid #dbe3ea;
      background:white;
      color:var(--ink);
      padding:9px 12px;
      border-radius:12px;
      font-size:14px;
      cursor:pointer;
    }
    button.primary{
      background:var(--brand);
      color:#fff;
      border-color:transparent;
      font-weight:700;
      box-shadow: 0 6px 14px rgba(79,70,229,.25);
    }
    button.secondary{
      background:#fff;
      color:var(--brand);
      border-color:#cfd8e3;
      font-weight:700;
    }

    .board-wrap{
      width:min(920px,100%);
      background:var(--card);
      border-radius:22px;
      box-shadow: 0 18px 40px rgba(0,0,0,.08);
      padding:18px;
    }

    .grid{
      width:100%;
      display:grid;
      grid-template-columns: repeat(3, 1fr); /* default; JS updates */
      gap:12px;
      transition:grid-template-columns .25s ease;
    }

    .hole{
      aspect-ratio:1/1;
      background:var(--hole);
      border-radius:18px;
      position:relative;
      overflow:hidden;
      box-shadow: inset 0 -10px 18px rgba(0,0,0,.06);
    }
    .mole{
      position:absolute;
      left:50%;
      transform: translate(-50%, 110%);
      bottom:0;
      font-size:clamp(28px,8vw,56px);
      line-height:1;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.25));
      transition: transform .18s ease;
      user-select:none;
      pointer-events:auto;
      touch-action:manipulation;
    }
    .mole.up{
      transform: translate(-50%, 5%);
      animation: bob 900ms ease-in-out infinite alternate;
    }
    @keyframes bob{
      from { transform: translate(-50%, 5%); }
      to   { transform: translate(-50%, -5%); }
    }
    .hit{
      animation: bonk .18s ease forwards;
    }
    @keyframes bonk{
      to{ transform: translate(-50%, 30%) scale(.88) rotate(-10deg); filter: drop-shadow(0 2px 4px rgba(0,0,0,.25)); }
    }

    .notice{
      text-align:center;
      color:var(--muted);
      padding-top:8px;
      font-size:13px;
    }

    .footer{
      color:var(--muted);
      font-size:12px;
      text-align:center;
    }

    /* Big thumbs */
    @media (max-width:560px){
      .grid{ gap:10px; }
      .hud{ padding:12px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>Whack-a-Mole üêπ</h1>
    <p class="sub">Tap the popping moles before they disappear. 60 seconds. Go!</p>
  </header>

  <section class="hud" role="region" aria-label="Game heads-up display">
    <div class="stats">
      <div class="badge" id="scoreBadge" aria-live="polite">Score: <span id="score">0</span></div>
      <div class="badge" id="timeBadge" aria-live="polite">Time: <span id="time">60</span>s</div>
      <div class="badge">Best: <span id="best">0</span></div>
    </div>
    <div class="controls">
      <label for="difficulty" class="sr-only">Difficulty</label>
      <select id="difficulty" title="Difficulty">
        <option value="easy">Easy</option>
        <option value="normal" selected>Normal</option>
        <option value="hard">Hard</option>
        <option value="insane">Insane</option>
      </select>

      <label for="gridSize" class="sr-only">Grid Size</label>
      <select id="gridSize" title="Grid size">
        <option value="3" selected>3 √ó 3</option>
        <option value="4">4 √ó 4</option>
        <option value="5">5 √ó 5</option>
      </select>

      <button class="secondary" id="resetBtn" type="button">Reset</button>
      <button class="primary" id="startBtn" type="button">Start</button>
    </div>
  </section>

  <section class="board-wrap">
    <div id="grid" class="grid" aria-label="Game board"></div>
    <div class="notice" id="notice">Press <b>Start</b> to begin.</div>
  </section>

  <div class="footer">Tip: On mobile, use a thumb. On desktop, click fast! ‚ö°</div>

  <script>
    (() => {
      // ---------- Elements
      const gridEl = document.getElementById('grid');
      const scoreEl = document.getElementById('score');
      const timeEl  = document.getElementById('time');
      const bestEl  = document.getElementById('best');
      const startBtn= document.getElementById('startBtn');
      const resetBtn= document.getElementById('resetBtn');
      const noticeEl= document.getElementById('notice');
      const difficultySel = document.getElementById('difficulty');
      const gridSizeSel   = document.getElementById('gridSize');

      // ---------- State
      let holes = [];
      let score = 0;
      let timeLeft = 60;
      let best = Number(localStorage.getItem('wam_best') || 0);
      bestEl.textContent = best;

      let gameRunning = false;
      let countdownTimer = null;
      let moleTimer = null;
      let lastHoleIndex = -1;
      let activeMole = null;
      let activeHit = false;

      // ---------- Helpers
      function rng(min, max){ return Math.floor(Math.random() * (max - min + 1)) + min; }

      function difficultyWindow() {
        switch (difficultySel.value) {
          case 'easy':   return { upMin: 900, upMax: 1200, gapMin: 120, gapMax: 220 };
          case 'normal': return { upMin: 650, upMax: 900,  gapMin: 100, gapMax: 180 };
          case 'hard':   return { upMin: 450, upMax: 700,  gapMin: 80,  gapMax: 140 };
          case 'insane': return { upMin: 300, upMax: 500,  gapMin: 60,  gapMax: 120 };
          default:       return { upMin: 650, upMax: 900,  gapMin: 100, gapMax: 180 };
        }
      }

      function setGridSize(size){
        gridEl.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
        gridEl.innerHTML = '';
        holes = [];
        for(let i=0; i<size*size; i++){
          const hole = document.createElement('div');
          hole.className = 'hole';
          const mole = document.createElement('div');
          mole.className = 'mole';
          mole.textContent = pickMoleEmoji();
          mole.setAttribute('role','button');
          mole.setAttribute('aria-label','Mole');
          mole.addEventListener('pointerdown', onMoleHit, {passive:true});
          hole.appendChild(mole);
          gridEl.appendChild(hole);
          holes.push({hole, mole});
        }
      }

      function pickMoleEmoji(){
        // a tiny pool for fun variety
        const pool = ['üêπ','üê≠','üê∞','üê∑','ü¶î','ü¶ä'];
        return pool[rng(0,pool.length-1)];
      }

      function pickHoleIndex(){
        if(holes.length<=1) return 0;
        let idx;
        do { idx = rng(0, holes.length-1); } while(idx === lastHoleIndex);
        lastHoleIndex = idx;
        return idx;
      }

      function spawnMoleLoop(){
        if(!gameRunning) return;

        const { upMin, upMax, gapMin, gapMax } = difficultyWindow();
        const duration = rng(upMin, upMax);
        const gap      = rng(gapMin, gapMax);

        // choose hole & show mole
        const idx = pickHoleIndex();
        const { mole } = holes[idx];
        mole.textContent = pickMoleEmoji(); // swap emoji sometimes
        activeMole = mole;
        activeHit = false;
        mole.classList.add('up');

        // hide after 'duration', then queue next after 'gap'
        moleTimer = setTimeout(() => {
          mole.classList.remove('up');
          activeMole = null;

          if(gameRunning){
            moleTimer = setTimeout(spawnMoleLoop, gap);
          }
        }, duration);
      }

      function onMoleHit(e){
        if(!gameRunning) return;
        const mole = e.currentTarget;
        if(mole !== activeMole) return;      // only the active mole counts
        if(!mole.classList.contains('up')) return;
        if(activeHit) return;                 // prevent double points on same mole

        activeHit = true;
        score++;
        scoreEl.textContent = score;

        // Visual feedback
        mole.classList.add('hit');
        setTimeout(() => mole.classList.remove('hit'), 180);

        // speed bonus (tiny): shorten current window a bit by hiding early
        mole.classList.remove('up');
      }

      function startGame(){
        if(gameRunning) return;
        gameRunning = true;
        score = 0;
        timeLeft = 60;
        scoreEl.textContent = score;
        timeEl.textContent = timeLeft;
        noticeEl.textContent = 'Game on! Whack as many as you can.';

        // disable selects while playing
        difficultySel.disabled = true;
        gridSizeSel.disabled = true;

        // timers
        spawnMoleLoop();
        countdownTimer = setInterval(() => {
          timeLeft--;
          timeEl.textContent = timeLeft;
          if(timeLeft <= 0){
            endGame();
          }
        }, 1000);
      }

      function endGame(){
        if(!gameRunning) return;
        gameRunning = false;

        clearInterval(countdownTimer);
        clearTimeout(moleTimer);
        countdownTimer = null;
        moleTimer = null;

        // hide any active mole
        if(activeMole) activeMole.classList.remove('up');
        activeMole = null;

        // update best
        if(score > best){
          best = score;
          localStorage.setItem('wam_best', String(best));
          bestEl.textContent = best;
          noticeEl.innerHTML = `üèÜ New best: <b>${best}</b>! Final score: <b>${score}</b>.`;
        } else {
          noticeEl.innerHTML = `‚è±Ô∏è Time! Final score: <b>${score}</b>. Best: <b>${best}</b>.`;
        }

        difficultySel.disabled = false;
        gridSizeSel.disabled = false;
      }

      function resetGame(){
        endGame();
        score = 0;
        timeLeft = 60;
        scoreEl.textContent = score;
        timeEl.textContent  = timeLeft;
        noticeEl.textContent = 'Press Start to begin.';
        // refresh moles so emoji reset
        const size = Number(gridSizeSel.value);
        setGridSize(size);
      }

      // ---------- Wire up UI
      startBtn.addEventListener('click', startGame);
      resetBtn.addEventListener('click', resetGame);
      gridSizeSel.addEventListener('change', () => {
        if(gameRunning) return;
        setGridSize(Number(gridSizeSel.value));
      });

      // ---------- First render
      setGridSize(Number(gridSizeSel.value));
    })();
  </script>
</body>
</html>
